package com.adiro.nasm_ide.gui.content;

import java.util.ArrayList;
import java.util.List;

import javafx.scene.control.Separator;
import javafx.scene.layout.HBox;
import javafx.scene.layout.VBox;
import javafx.scene.text.Font;
import javafx.scene.text.FontPosture;
import javafx.scene.text.Text;

public class RegistersView extends VBox{
	
	private StandardRegister ax;
	private StandardRegister bx;
	private StandardRegister cx;
	private StandardRegister dx;
	private FlagsRegister flags;

	public RegistersView() {
		super();
		
		ax = new StandardRegister(" A");
		bx = new StandardRegister(" B");
		cx = new StandardRegister(" C");
		dx = new StandardRegister(" D");
		flags = new FlagsRegister();
		
		
		
		getChildren().add(ax);
		getChildren().add(new Separator());
		getChildren().add(bx);
		getChildren().add(new Separator());
		getChildren().add(cx);
		getChildren().add(new Separator());
		getChildren().add(dx);
		getChildren().add(new Separator());
		getChildren().add(flags);
	}
	
	public void setAx(int newValue) {
		ax.setValue(newValue);
	}
	
	public void setBx(int newValue) {
		bx.setValue(newValue);
	}
	
	public void setCx(int newValue) {
		cx.setValue(newValue);
	}
	
	public void setDx(int newValue) {
		dx.setValue(newValue);
	}
	
	public void setFlags(int newValue) {
		flags.setValue(newValue);
	}
	
	private class StandardRegister extends HBox{
		int value = 0;
		private Text rxText;
		private Text rlText;
		private Text rhText;
		private String registerLetter;
		
		public StandardRegister(String registerLetter) {
			super();
			this.registerLetter = registerLetter;
			
			rxText = new Text(registerLetter + "X: " + Integer.toString(value));
			rxText.setFont(Font.font("Arial", FontPosture.REGULAR, 20));
			var rx = new HBox(rxText);
			rx.setMinWidth(150);
			
			rlText = new Text(registerLetter + "L: " + Integer.toString(value & 0x00FF));
			rlText.setFont(Font.font("Arial", FontPosture.REGULAR, 12));
			var rl = new HBox(rlText);
			rl.setMinWidth(100);
			
			rhText = new Text(registerLetter + "H: " + Integer.toString(value >> 8));
			rhText.setFont(Font.font("Arial", FontPosture.REGULAR, 12));
			var rh = new HBox(rhText);
			rh.setMinWidth(100);
			
			var halves = new VBox(rh, rl);
			
			getChildren().addAll(rx, halves);
		}
		
		public void setValue(int newValue) {
			rxText.setText(registerLetter + "X: " + Integer.toString(newValue));
			rlText.setText(registerLetter + "L: " + Integer.toString(newValue & 0x00FF));
			rhText.setText(registerLetter + "H: " + Integer.toString(newValue >> 8));
			
		}
	}
	
	private class FlagsRegister extends VBox{
		
		private Text[] flags;
		
		public FlagsRegister() {
			super();
			flags = new Text[16];
			flags[0] = new Text("CF: ");
			flags[1] = new Text(" 1: ");
			flags[2] = new Text("PF: ");
			flags[3] = new Text(" 0: ");
			flags[4] = new Text("AF: ");
			flags[5] = new Text(" 0: ");
			flags[6] = new Text("ZF: ");
			flags[7] = new Text("SF: ");
			flags[8] = new Text("TF: ");
			flags[9] = new Text("IF: ");
			flags[10] = new Text("DF: ");
			flags[11] = new Text("OF: ");
			flags[12] = new Text("PL: ");
			flags[13] = new Text("IO: ");
			flags[14] = new Text("NT: ");
			flags[15] = new Text(" 0: ");
			
			for(var flag : flags) {
				getChildren().add(flag);
			}
			
		}
		
		public void setValue(int newValue) {
			
			for(int i = 0; i < flags.length; i++) {
				var label = flags[i].getText().substring(0, 3);
				flags[i].setText(label + Integer.toString((newValue >> i) & 1));
			}
		}
	}
}
